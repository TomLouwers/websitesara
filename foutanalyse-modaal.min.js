const errorTypeLabels={conversiefout:{emoji:"ğŸ’¡",title:"Bijna goed! Er is een omrekenstap vergeten",color:"#ef4444",concept:"het omrekenen van eenheden"},leesfout_ruis:{emoji:"ğŸ“–",title:"Let op! Er staat iets belangrijks in de tekst",color:"#f59e0b",concept:"het herkennen van belangrijke informatie"},conceptfout:{emoji:"ğŸ§ ",title:"Probeer het anders! Kijk nog eens naar de rekenregel",color:"#8b5cf6",concept:"het toepassen van de juiste rekenregel"},rekenfout_basis:{emoji:"ğŸ”¢",title:"Check je rekenwerk nog eens! ğŸ’ª",color:"#3b82f6",concept:"de basis rekenvaardigheid"}},exerciseTitles={301:"Tijd omrekenen",205:"Positieve en negatieve getallen",102:"Tafels van vermenigvuldiging (1-10)"};let attemptCount=0;function showFoutanalyseModaal(e,n,t=1,o=null){const i=1===t;if(t>=3&&o)return void showFullSolution(o,n);const s=document.getElementById("foutanalyseModaal");if(!s)return void console.error("Foutanalyse modaal element niet gevonden. Voeg de HTML toe aan index.html");const a=errorTypeLabels[e.error_type]||errorTypeLabels.rekenfout_basis,l=document.getElementById("errorBadge");l.className=`error-badge ${e.error_type}`,l.innerHTML=`\n    <span class="error-emoji">${a.emoji}</span>\n    <span class="error-title">${a.title}</span>\n  `;const{mainText:d,reflectionQuestion:r}=parseFoutanalyse(e.foutanalyse);document.getElementById("mainExplanation").textContent=d;const c=document.getElementById("reflectionBox");r?(document.getElementById("reflectionText").textContent=r,c.style.display="block"):c.style.display="none";const u=document.getElementById("visualAidSection");if(!i&&e.visual_aid_query){document.getElementById("visualAidTitle").textContent=e.visual_aid_query,renderVisualAid(e.visual_aid_query);const t=document.getElementById("videoButton");n&&n.video_uitleg?(document.getElementById("videoTitle").textContent=n.video_uitleg.titel,t.style.display="flex",t.onclick=()=>window.open(n.video_uitleg.url,"_blank")):t.style.display="none",u.style.display="block"}else u.style.display="none";const g=document.getElementById("remedialSection");if(!i&&e.remedial_basis_id&&("conversiefout"===e.error_type||"rekenfout_basis"===e.error_type)){const n=exerciseTitles[e.remedial_basis_id]||`Oefening ${e.remedial_basis_id}`;document.getElementById("remedialExplanation").textContent=`Laten we ${a.concept} nog een keer oefenen!`,document.getElementById("remedialCtaText").innerHTML=`\n      Oefen Basissom #${e.remedial_basis_id}:<br />\n      <strong>"${n}"</strong>\n    `,document.getElementById("remedialCta").onclick=()=>{navigateToExercise(e.remedial_basis_id)},g.style.display="block"}else g.style.display="none";s.classList.add("show"),i&&o&&o.hint?(s.dataset.showHintAfterClose="true",s.dataset.hintText=o.hint):s.dataset.showHintAfterClose="false"}function closeFoutanalyseModaal(){const e=document.getElementById("foutanalyseModaal");if(e.classList.remove("show"),"true"===e.dataset.showHintAfterClose&&e.dataset.hintText){const n=e.dataset.hintText;e.dataset.showHintAfterClose="false",e.dataset.hintText="",setTimeout(()=>{showHintButton(n)},100)}}function showFullSolution(e,n){const t=document.getElementById("successModaal");if(!t)return void console.error("Success modaal element niet gevonden.");const o=t.querySelector(".modaal-header h2");o&&(o.textContent="ğŸ“– Hier is de volledige oplossing"),e.lova&&renderLovaContent(e.lova),n&&n.berekening_tabel&&renderBerekeningTabel(n.berekening_tabel),n&&n.concept&&(document.getElementById("conceptText").textContent=n.concept);const i=t.querySelector(".modaal-actions button");i&&(i.textContent="Volgende Vraag",i.onclick=()=>{closeSuccessModaal(),"function"==typeof nextQuestion&&nextQuestion()}),t.classList.add("show")}function showSuccessModaal(e,n){const t=document.getElementById("successModaal");if(!t)return void console.error("Success modaal element niet gevonden. Voeg de HTML toe aan index.html");const o=t.querySelector(".modaal-header h2");o&&(o.textContent="âœ… Goed gedaan! Hier is de uitleg");const i=t.querySelector(".modaal-actions button");i&&(i.textContent="Volgende Vraag",i.onclick=()=>nextQuestion()),e.lova&&renderLovaContent(e.lova),n&&n.berekening_tabel&&renderBerekeningTabel(n.berekening_tabel),n&&n.concept&&(document.getElementById("conceptText").textContent=n.concept),t.classList.add("show")}function closeSuccessModaal(){document.getElementById("successModaal").classList.remove("show")}function parseFoutanalyse(e){const n=e.split(/ğŸ¤” \*\*Reflectievraag:\*\*/);return{mainText:n[0].trim(),reflectionQuestion:n[1]?n[1].trim():null}}function renderVisualAid(e){const n=document.getElementById("visualAidContent"),t={"Conversietabel uren naar minuten":renderTimeConversionTable,"Tijdlijn met rustpauze":renderTimelineWithBreak,"Puntentabel raak vs mis":renderPointsTable,"Verhoudingstabel positieve en negatieve punten":renderRatioTable,"Geld uitgeven visualisatie":renderMoneySpendingVisualization}[e];t?(n.innerHTML="",t(n)):n.innerHTML='<p style="color: #6b7280;">Visuele hulp wordt geladen...</p>'}function renderTimeConversionTable(e){e.innerHTML='\n    <table class="conversion-table">\n      <thead>\n        <tr>\n          <th>Uren</th>\n          <th>Minuten</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr class="highlight">\n          <td>1 uur</td>\n          <td>60 minuten ğŸ‘ˆ</td>\n        </tr>\n        <tr>\n          <td>2 uur</td>\n          <td>120 minuten</td>\n        </tr>\n        <tr>\n          <td>3 uur</td>\n          <td>180 minuten</td>\n        </tr>\n      </tbody>\n    </table>\n  '}function renderTimelineWithBreak(e){e.innerHTML='\n    <div style="text-align: center; padding: 20px;">\n      <div style="font-size: 16px; margin-bottom: 10px;">\n        ğŸš´ â”€â”€â”€â”€â”€â”€â”€â”€ ğŸ›‘ (15 min pauze) â”€â”€â”€â”€â”€â”€â”€â”€ ğŸ \n      </div>\n      <div style="font-size: 14px; color: #6b7280;">\n        <strong>Totale tijd:</strong> 1 uur 45 min<br>\n        <strong>Rustpauze:</strong> 15 min<br>\n        <strong>Netto fitstijd:</strong> 105 - 15 = 90 min\n      </div>\n    </div>\n  '}function renderPointsTable(e){e.innerHTML='\n    <table class="conversion-table">\n      <thead>\n        <tr>\n          <th>Type</th>\n          <th>Aantal</th>\n          <th>Punten per bal</th>\n          <th>Totaal</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr class="highlight">\n          <td>âœ… Raak</td>\n          <td>9</td>\n          <td>+3</td>\n          <td>+27 punten</td>\n        </tr>\n        <tr>\n          <td>âŒ Mis</td>\n          <td>6</td>\n          <td>-1</td>\n          <td>-6 punten</td>\n        </tr>\n        <tr style="background-color: #fef3c7; font-weight: bold;">\n          <td colspan="3">Eindtotaal</td>\n          <td>21 punten</td>\n        </tr>\n      </tbody>\n    </table>\n  '}function renderRatioTable(e){e.innerHTML='\n    <div style="text-align: center; padding: 20px;">\n      <p style="font-size: 16px; margin-bottom: 15px;">\n        Bij positieve en negatieve getallen moet je <strong>twee bewerkingen</strong> uitvoeren:\n      </p>\n      <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">\n        <div style="background: #d4edda; padding: 15px; border-radius: 8px; min-width: 150px;">\n          <div style="font-size: 32px;">â•</div>\n          <div style="font-weight: bold; margin-top: 8px;">Positief</div>\n          <div style="font-size: 14px; color: #155724;">Tel de winst op</div>\n        </div>\n        <div style="background: #f8d7da; padding: 15px; border-radius: 8px; min-width: 150px;">\n          <div style="font-size: 32px;">â–</div>\n          <div style="font-weight: bold; margin-top: 8px;">Negatief</div>\n          <div style="font-size: 14px; color: #721c24;">Trek het verlies af</div>\n        </div>\n      </div>\n    </div>\n  '}function renderMoneySpendingVisualization(e){e.innerHTML='\n    <div style="text-align: center; padding: 20px;">\n      <p style="font-size: 16px; margin-bottom: 20px; font-weight: 600;">\n        Geld uitgeven betekent <strong>aftrekken</strong>!\n      </p>\n      <div style="display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap;">\n        <div style="background: #d4edda; padding: 20px; border-radius: 12px; min-width: 140px; border: 3px solid #28a745;">\n          <div style="font-size: 40px; margin-bottom: 8px;">ğŸ’°</div>\n          <div style="font-weight: bold; font-size: 18px; color: #155724;">Start Budget</div>\n          <div style="font-size: 24px; color: #28a745; margin-top: 5px;">â‚¬400</div>\n        </div>\n\n        <div style="font-size: 40px; color: #dc3545;">â–</div>\n\n        <div style="background: #f8d7da; padding: 20px; border-radius: 12px; min-width: 140px; border: 3px solid #dc3545;">\n          <div style="font-size: 40px; margin-bottom: 8px;">ğŸ’¸</div>\n          <div style="font-weight: bold; font-size: 18px; color: #721c24;">Uitgegeven</div>\n          <div style="font-size: 24px; color: #dc3545; margin-top: 5px;">â‚¬372</div>\n        </div>\n\n        <div style="font-size: 40px; color: #28a745;">=</div>\n\n        <div style="background: #fff3cd; padding: 20px; border-radius: 12px; min-width: 140px; border: 3px solid #ffc107;">\n          <div style="font-size: 40px; margin-bottom: 8px;">âœ¨</div>\n          <div style="font-weight: bold; font-size: 18px; color: #856404;">Overblijft</div>\n          <div style="font-size: 24px; color: #ffc107; margin-top: 5px;">â‚¬28</div>\n        </div>\n      </div>\n      <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 8px; border-left: 4px solid #007bff;">\n        <div style="font-size: 14px; color: #004085; font-weight: 600;">\n          ğŸ’¡ Rekenregel: Budget - Uitgaven = Overblijft\n        </div>\n      </div>\n    </div>\n  '}function renderLovaContent(e){const n=document.getElementById("lovaContent");let t="";t+=`\n    <div class="lova-step">\n      <h4>ğŸ“– Stap 1: LEZEN</h4>\n      <ul>\n        <li><strong>Hoofdvraag:</strong> ${e.stap1_lezen.hoofdvraag}</li>\n        <li><strong>Ruis (negeer):</strong> ${e.stap1_lezen.ruis.join(", ")}</li>\n        <li><strong>Tussenstappen:</strong>\n          <ol>\n            ${e.stap1_lezen.tussenstappen.map(e=>`<li>${e}</li>`).join("")}\n          </ol>\n        </li>\n      </ul>\n    </div>\n  `,t+=`\n    <div class="lova-step">\n      <h4>ğŸ“‹ Stap 2: ORDENEN</h4>\n      <ul>\n        <li><strong>Relevante getallen:</strong>\n          <ul>\n            ${Object.entries(e.stap2_ordenen.relevante_getallen).map(([e,n])=>`<li>${e}: ${n}</li>`).join("")}\n          </ul>\n        </li>\n        <li><strong>Tool:</strong> ${e.stap2_ordenen.tool}</li>\n        ${e.stap2_ordenen.conversies.length>0?`<li><strong>Conversies:</strong> ${e.stap2_ordenen.conversies.join(", ")}</li>`:""}\n      </ul>\n    </div>\n  `,t+=`\n    <div class="lova-step">\n      <h4>ğŸ”§ Stap 3: VORMEN (berekeningen)</h4>\n      ${e.stap3_vormen.bewerkingen.map(e=>`\n        <div class="calculation-step">\n          <strong>${e.stap}:</strong><br>\n          <code>${e.berekening}</code> = <strong>${e.resultaat}</strong><br>\n          <em>(${e.uitleg})</em>\n        </div>\n      `).join("")}\n    </div>\n  `,t+=`\n    <div class="lova-step">\n      <h4>âœï¸ Stap 4: ANTWOORDEN</h4>\n      <ul>\n        <li><strong>Verwachte eenheid:</strong> ${e.stap4_antwoorden.verwachte_eenheid}</li>\n        <li><strong>Logica check:</strong> ${e.stap4_antwoorden.logica_check}</li>\n        <li><strong>Antwoord:</strong> <span class="final-answer">${e.stap4_antwoorden.antwoord}</span></li>\n      </ul>\n    </div>\n  `,n.innerHTML=t}function toggleLovaAccordion(){const e=document.getElementById("lovaContent"),n=document.getElementById("lovaToggleIcon");e.classList.contains("open")?(e.classList.remove("open"),n.textContent="â–¼"):(e.classList.add("open"),n.textContent="â–²")}function renderBerekeningTabel(e){const n=document.getElementById("berekeningTable"),t=e.join("\n").split("\n").filter(e=>e.trim());let o="<table>";t.forEach((e,n)=>{if(1===n)return;const t=e.split("|").filter(e=>e.trim()).map(e=>e.trim());0===n?(o+="<thead><tr>",t.forEach(e=>{o+=`<th>${e}</th>`}),o+="</tr></thead><tbody>"):(o+="<tr>",t.forEach(e=>{o+=`<td>${e}</td>`}),o+="</tr>")}),o+="</tbody></table>",n.innerHTML=o}function navigateToExercise(e){closeFoutanalyseModaal(),"function"==typeof loadSubject&&loadSubject("basisvaardigheden"),setTimeout(()=>{console.log(`Navigeren naar basisoefening: ${e}`)},500)}function showHintButton(e){if(!e)return;const n=document.getElementById("hintContainer");n&&""===n.innerHTML.trim()&&(n.innerHTML=`\n      <button class="hint-toggle" onclick="toggleHint()">\n        ğŸ’¡ Hulp nodig?\n      </button>\n      <div id="hintBox" class="hint-box" style="display: none;">\n        ${e}\n      </div>\n    `)}function toggleHint(){const e=document.getElementById("hintBox");e&&(e.style.display="none"===e.style.display?"block":"none")}function resetAttemptTracking(){attemptCount=0}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("foutanalyseModaal");e&&e.addEventListener("click",n=>{n.target===e&&closeFoutanalyseModaal()})}),console.log("âœ… Foutanalyse Modaal geladen (Vanilla JavaScript versie)"),console.log("ğŸ“– Gebruik showFoutanalyseModaal(option, extraInfo) om de modaal te openen"),console.log("âœ… Gebruik showSuccessModaal(question, extraInfo) voor juiste antwoorden");