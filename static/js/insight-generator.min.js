class InsightGenerator{static detectSubject(e,t={}){if((t.content||t.visual)&&(t.skill||t.strategy))return"begrijpendlezen";const r=t.lova&&Object.keys(t.lova).length>0,n=t.options?.some(e=>e.foutanalyse);if(r||n)return"verhaaltjessommen";if(!e)return"general";if("object"==typeof e){if(e.betekenis)return"vocabulary";if(e.regel||e.voorbeelden||e.examples)return"spelling";if(e.steps||e.berekening||e.verhoudingstabel)return"math";if(e.tips&&Array.isArray(e.tips))return"math"}const a="string"==typeof e?e:JSON.stringify(e).toLowerCase();return a.match(/\d+|bewerking|rekenen|delen|vermenigvuldig|optellen|aftrekken|breuk|procent|verhoudingstabel|berekening/)?"math":a.match(/\bregel\b|medeklinker|klinker|werkwoord|voltooid|verleden tijd|lettergreep|spelling|voorbeelden/)?"spelling":a.match(/betekenis|definitie|synoniem|antoniem/)?"vocabulary":"general"}static extractFirstSentence(e){if(!e)return"";const t=e.replace(/[*_#]/g,"").trim(),r=t.match(/^[^.!?]+[.!?]/);return r?r[0].trim():t.split("\n")[0].trim()}static toJijVorm(e){if(!e)return"";return e.replace(/\b[A-D][:.)\]]/g,"").replace(/^Let op:/i,"Let op:").replace(/^Onthoud:/i,"Onthoud:").replace(/^Tip:/i,"").replace(/^ðŸ’¡/g,"").trim()}static buildVerhaaltjesomInsight(e,t){let r=e?.foutanalyse||"";r=r.split("ðŸ¤”")[0].trim();let n="";const a=t.lova||{};if(a.stap1_lezen?.focus)n=a.stap1_lezen.focus;else if(a.stap1_lezen?.hoofdvraag)n=`let op wat er gevraagd wordt: ${a.stap1_lezen.hoofdvraag.toLowerCase()}`;else if(a.stap2_ordenen?.conversies&&a.stap2_ordenen.conversies.length>0){n=`denk aan de omrekening: ${a.stap2_ordenen.conversies[0]}`}else if(a.stap3_vormen?.bewerkingen&&a.stap3_vormen.bewerkingen.length>0){const e=a.stap3_vormen.bewerkingen[0];e.uitleg&&(n=e.uitleg.toLowerCase())}if(r){if(r=this.extractFirstSentence(r),r=this.toJijVorm(r),n){n=this.toJijVorm(n);let e="omdat";return r.toLowerCase().includes("vergat")||r.toLowerCase().includes("vergeet")?e="want":r.toLowerCase().includes("dan")&&(e="daardoor"),`${r} ${e} ${n}`}return r}return n?`Let op: ${n}`:"Let goed op wat er gevraagd wordt."}static buildBegrijpendLezenInsight(e,t){let r=e?.foutanalyse||"";if(r=r.split("ðŸ¤”")[0].trim(),r&&r.length>10){const e=this.toJijVorm(this.extractFirstSentence(r));if(e.split(/\s+/).length<=25)return e}const n=t.strategy||"",a={"Informatie zoeken":"Je keek naar details, maar de vraag ging over het grotere geheel.","Conclusies trekken":"Je koos wat er letterlijk stond, maar de vraag vroeg om na te denken.","Verbanden leggen":"Je koos Ã©Ã©n deel, maar de vraag vroeg om verschillende delen te verbinden.",Voorspellen:"Je keek naar wat er al gebeurd was, terwijl de vraag over wat nog komt ging.",Samenvatten:"Je lette op Ã©Ã©n stukje tekst, terwijl de vraag over het hele verhaal ging.",Interpreteren:"Je las wat er stond, maar de vraag vroeg om tussen de regels door te lezen.",Hoofdgedachte:"Je koos een detail, maar de vraag ging over waar het hele stuk over gaat.","Titel bedenken":"Je koos een letterlijke zin, maar de vraag was waar het stuk over gaat.","Oorzaak en gevolg":"Je raadde wat logisch leek, maar de vraag was wat er echt in de tekst staat.",Personages:"Je vulde zelf iets in, maar de vraag was wat de tekst over het personage zegt."};if(n&&a[n])return a[n];const o=t.hint||"";if(o){const e=o.replace(/^ðŸ’¡\s*/i,"").trim(),t=this.toJijVorm(this.extractFirstSentence(e));if(t.length>10&&t.split(/\s+/).length<=25)return t}const i=t.skill||"",s={Letterlijk:"Je lette op andere woorden dan waar de vraag over ging.",Interpreterend:"Je las wat er stond, maar de vraag vroeg om goed na te denken.",Reflecterend:"Je dacht aan je eigen ervaring, maar de vraag ging over de tekst."};return i&&s[i]?s[i]:"Je lette op iets anders dan waar de vraag over ging."}static buildGeneralInsight(e,t){if(!e)return"Let goed op wat er gevraagd wordt.";let r="";if("object"==typeof e)if(e.concept)r=e.concept;else if(e.regel)r=e.regel;else if(e.betekenis)r=`Betekent: ${e.betekenis}`;else if(e.tips&&Array.isArray(e.tips)&&e.tips.length>0)r=e.tips[0];else if(e.tip)r=Array.isArray(e.tip)?e.tip[0]:e.tip;else if(e.voorbeelden&&Array.isArray(e.voorbeelden)&&e.voorbeelden.length>0)r=e.voorbeelden[0];else if(e.examples&&Array.isArray(e.examples)&&e.examples.length>0)r=e.examples[0];else if(e.uitleg)r=e.uitleg;else if(e.steps&&Array.isArray(e.steps)&&e.steps.length>0){const t=e.steps[0];r="string"==typeof t?t:t.uitleg||t.text||""}else{r=Object.values(e).find(e=>"string"==typeof e&&e.length>0)||""}else r=e;if(r=this.extractFirstSentence(r),r=this.toJijVorm(r),r&&!r.match(/^(Onthoud|Let op|Betekent|Tip):/i))switch(t){case"math":case"spelling":r=`Onthoud: ${r.charAt(0).toLowerCase()}${r.slice(1)}`;break;case"vocabulary":r.toLowerCase().startsWith("betekent")||(r=`Betekent: ${r.charAt(0).toLowerCase()}${r.slice(1)}`);break;case"general":r=`Let op: ${r.charAt(0).toLowerCase()}${r.slice(1)}`}return r&&!r.match(/[.!?]$/)&&(r+="."),r||"Let goed op wat er gevraagd wordt."}static generateCorrectInsight(e){const t=this.detectSubject(e.extra_info,e),r=e.extra_info;if("begrijpendlezen"===t){const t={"Informatie zoeken":"Je lette goed op de juiste informatie in de tekst.","Conclusies trekken":"Je dacht goed na over wat er in het verhaal gebeurde.","Verbanden leggen":"Je verbond de verschillende delen uit de tekst goed.",Voorspellen:"Je lette goed op wat er nog zou kunnen gebeuren.",Samenvatten:"Je lette goed op waar het hele verhaal over ging.",Interpreteren:"Je dacht goed na over wat de schrijver bedoelde.",Hoofdgedachte:"Je lette goed op waar het hele stuk over ging.","Titel bedenken":"Je keek goed naar waar de tekst over gaat.","Oorzaak en gevolg":"Je lette goed op wat er in de tekst staat.",Personages:"Je lette goed op wat de tekst over het personage zegt."};if(e.strategy&&t[e.strategy])return t[e.strategy];if(r&&"string"==typeof r){const e=this.toJijVorm(this.extractFirstSentence(r));if(e.split(/\s+/).length<=25)return e}else if(r&&"object"==typeof r)if(r.concept){const e=this.toJijVorm(this.extractFirstSentence(r.concept));if(e.split(/\s+/).length<=25)return e}else if(r.tips&&r.tips.length>0){const e=this.toJijVorm(this.extractFirstSentence(r.tips[0]));if(e.split(/\s+/).length<=25)return e}return"Je lette goed op wat de vraag vroeg."}return"verhaaltjessommen"===t?"object"==typeof r&&r.concept?this.buildGeneralInsight(r.concept,"general"):this.buildGeneralInsight(r,"general"):this.buildGeneralInsight(r,t)}static generateIncorrectInsight(e,t){const r=this.detectSubject(e.extra_info,e);if("begrijpendlezen"===r){return this.buildBegrijpendLezenInsight(t,e)}if("verhaaltjessommen"===r){const r=this.buildVerhaaltjesomInsight(t,e),n=r.match(/^(let|lees|kijk|denk|probeer|controleer|check|tel|reken)\s/i);return r.match(/^Let op:/i)||n?r:`Let op: ${r.charAt(0).toLowerCase()}${r.slice(1)}`}let n=this.buildGeneralInsight(e.extra_info,r);n=n.replace(/^(Onthoud|Betekent|Tip):\s*/i,"");const a=n.match(/^(let|lees|kijk|denk|probeer|controleer|check)\s/i);return n.match(/^Let op:/i)||a||(n=`Let op: ${n.charAt(0).toLowerCase()}${n.slice(1)}`),n}static buildConfirmation(e,t,r){const n=e.options[t],a="string"==typeof n?n:n?.text||"";if(r)return`Dit klopt: ${a}`;if("verhaaltjessommen"===this.detectSubject(e.extra_info,e)){const t=e.lova||{};if(t.stap3_vormen?.bewerkingen&&t.stap3_vormen.bewerkingen.length>0){const e=t.stap3_vormen.bewerkingen.map(e=>e.berekening).filter(Boolean).join(" â†’ ");if(e&&e.length<60)return`Het juiste antwoord is: ${a} (${e})`}}return`Het juiste antwoord is: ${a}`}}"undefined"!=typeof module&&module.exports&&(module.exports=InsightGenerator);