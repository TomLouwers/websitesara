class AccessibilityManager{constructor(){if(AccessibilityManager.instance)return AccessibilityManager.instance;this.elements={},this.settings={fontSize:CONFIG.accessibility.defaults.fontSize,dyslexiaMode:CONFIG.accessibility.defaults.dyslexiaMode,focusMode:!1,highContrast:CONFIG.accessibility.defaults.highContrast},AccessibilityManager.instance=this}init(){this.cacheElements(),this.loadSettings(),this.attachEventListeners()}cacheElements(){this.elements={toggle:document.getElementById("accessibilityToggle"),panel:document.getElementById("accessibilityPanel"),fontSizeButtons:document.querySelectorAll(".font-size-btn"),dyslexiaCheckbox:document.getElementById("dyslexiaMode"),focusModeCheckbox:document.getElementById("focusMode"),highContrastCheckbox:document.getElementById("highContrastMode"),body:document.body}}attachEventListeners(){const{toggle:e,panel:t,dyslexiaCheckbox:s,focusModeCheckbox:i,highContrastCheckbox:o}=this.elements;e&&e.addEventListener("click",()=>this.togglePanel()),document.addEventListener("click",s=>{t&&e&&!t.contains(s.target)&&!e.contains(s.target)&&t.classList.remove("open")}),this.elements.fontSizeButtons.forEach(e=>{e.addEventListener("click",e=>this.handleFontSizeChange(e.target))}),s&&s.addEventListener("change",e=>this.updateSetting("dyslexiaMode",e.target.checked,this.toggleDyslexiaMode.bind(this))),i&&i.addEventListener("change",e=>this.updateSetting("focusMode",e.target.checked,this.toggleFocusMode.bind(this))),o&&o.addEventListener("change",e=>this.updateSetting("highContrast",e.target.checked,this.toggleHighContrastMode.bind(this)))}togglePanel(){this.elements.panel?.classList.toggle("open")}handleFontSizeChange(e){const t=e.dataset.size;t&&(this.setFontSize(t),DOMUtils.toggleButtonGroup(this.elements.fontSizeButtons,t,"size"),this.updateSetting("fontSize",t))}updateSetting(e,t,s){this.settings[e]=t;const i=CONFIG.accessibility.storageKeys[e]||`accessibility${e.charAt(0).toUpperCase()+e.slice(1)}`;storage.set(i,t),s&&s(t)}loadSettings(){const e=storage.get(CONFIG.accessibility.storageKeys.fontSize,CONFIG.accessibility.defaults.fontSize);this.setFontSize(e),DOMUtils.toggleButtonGroup(this.elements.fontSizeButtons,e,"size");const t=storage.get(CONFIG.accessibility.storageKeys.dyslexia,CONFIG.accessibility.defaults.dyslexiaMode);this.elements.dyslexiaCheckbox&&(this.elements.dyslexiaCheckbox.checked=t),this.toggleDyslexiaMode(t);const s=storage.get("accessibilityFocusMode",!1);this.elements.focusModeCheckbox&&(this.elements.focusModeCheckbox.checked=s),this.toggleFocusMode(s);const i=storage.get(CONFIG.accessibility.storageKeys.highContrast,CONFIG.accessibility.defaults.highContrast);this.elements.highContrastCheckbox&&(this.elements.highContrastCheckbox.checked=i),this.toggleHighContrastMode(i),this.settings={fontSize:e,dyslexiaMode:t,focusMode:s,highContrast:i}}setFontSize(e){const{body:t}=this.elements;if(!t)return;Object.values(CONFIG.accessibility.fontSizes).forEach(({className:e})=>{t.classList.remove(e)}),t.classList.remove("font-scale-groot","font-scale-extra-groot");const s=CONFIG.accessibility.fontSizes[e];s&&"normal"!==e&&t.classList.add(s.className),"groot"===e||"large"===e?t.classList.add("font-scale-groot"):"extra-groot"!==e&&"xlarge"!==e||t.classList.add("font-scale-extra-groot")}toggleDyslexiaMode(e){this.elements.body?.classList.toggle("dyslexia-mode",e),this.settings.dyslexiaMode=e}toggleFocusMode(e){this.elements.body?.classList.toggle("focus-mode",e),this.settings.focusMode=e}toggleHighContrastMode(e){this.elements.body?.classList.toggle("high-contrast",e),this.settings.highContrast=e}reset(){Object.values(CONFIG.accessibility.storageKeys).forEach(e=>{storage.remove(e)}),storage.remove("accessibilityFocusMode"),storage.flush();const e=CONFIG.accessibility.defaults;this.setFontSize(e.fontSize),this.toggleDyslexiaMode(e.dyslexiaMode),this.toggleFocusMode(!1),this.toggleHighContrastMode(e.highContrast),this.elements.dyslexiaCheckbox&&(this.elements.dyslexiaCheckbox.checked=!1),this.elements.focusModeCheckbox&&(this.elements.focusModeCheckbox.checked=!1),this.elements.highContrastCheckbox&&(this.elements.highContrastCheckbox.checked=!1),DOMUtils.toggleButtonGroup(this.elements.fontSizeButtons,e.fontSize,"size")}getSettings(){return{...this.settings}}}document.addEventListener("DOMContentLoaded",function(){const e=new AccessibilityManager;e.init(),window.accessibilityManager=e}),"undefined"!=typeof module&&module.exports&&(module.exports={AccessibilityManager:AccessibilityManager});