class StorageManager{constructor(){this.cache=new Map,this.writeQueue=new Map,this.flushTimer=null}get(e,t=null){if(this.cache.has(e))return this.cache.get(e);try{const t=localStorage.getItem(e);if(null!==t){const s=this.parseValue(t);return this.cache.set(e,s),s}}catch(t){console.warn(`StorageManager: Failed to get ${e}:`,t)}return t}set(e,t){this.cache.set(e,t),this.writeQueue.set(e,t),clearTimeout(this.flushTimer),this.flushTimer=setTimeout(()=>this.flush(),300)}flush(){this.writeQueue.forEach((e,t)=>{try{const s="string"==typeof e?e:JSON.stringify(e);localStorage.setItem(t,s)}catch(e){console.warn(`StorageManager: Failed to set ${t}:`,e)}}),this.writeQueue.clear()}remove(e){this.cache.delete(e),this.writeQueue.delete(e);try{localStorage.removeItem(e)}catch(t){console.warn(`StorageManager: Failed to remove ${e}:`,t)}}parseValue(e){if(e.startsWith("{")||e.startsWith("["))try{return JSON.parse(e)}catch(t){return e}return"true"===e||"false"!==e&&(isNaN(e)||""===e?e:Number(e))}clear(e=!1){if(this.cache.clear(),this.writeQueue.clear(),clearTimeout(this.flushTimer),e)try{localStorage.clear()}catch(e){console.warn("StorageManager: Failed to clear storage:",e)}}}const storage=new StorageManager;class AudioManager{constructor(){this.currentAudio=null,this.isPlaying=!1}async playAudio(e,t,s={}){const{timeout:r=2e3,onProgress:n=null}=s;this.stop();try{await this.playAudioFile(e,r,n)}catch(e){if(console.log("Audio playback failed, using TTS:",e.message),!t)throw new Error("No fallback text provided for TTS");await this.playTextToSpeech(t)}}playAudioFile(e,t,s){return new Promise((r,n)=>{const i=new Audio(e);this.currentAudio=i,this.isPlaying=!0;let a=null,o=!1;const c=()=>{clearTimeout(a),this.isPlaying=!1,this.currentAudio===i&&(this.currentAudio=null)},l=(e=null)=>{o||(o=!0,c(),e?n(e):r())};a=setTimeout(()=>{l(new Error("Audio loading timeout"))},t),i.addEventListener("ended",()=>l()),i.addEventListener("error",e=>{l(new Error(`Audio error: ${e.message||"Unknown error"}`))}),s&&i.addEventListener("timeupdate",()=>{s(i.currentTime,i.duration)}),i.play().catch(e=>{l(new Error(`Playback failed: ${e.message}`))})})}playTextToSpeech(e){return new Promise((t,s)=>{if(!("speechSynthesis"in window))return void s(new Error("Text-to-Speech not supported"));const r=new SpeechSynthesisUtterance(e);r.lang="nl-NL",r.rate=.9,this.isPlaying=!0,r.addEventListener("end",()=>{this.isPlaying=!1,t()}),r.addEventListener("error",e=>{this.isPlaying=!1,s(new Error(`TTS error: ${e.error}`))}),window.speechSynthesis.speak(r)})}stop(){this.currentAudio&&(this.currentAudio.pause(),this.currentAudio.currentTime=0,this.currentAudio=null),window.speechSynthesis&&window.speechSynthesis.speaking&&window.speechSynthesis.cancel(),this.isPlaying=!1}getIsPlaying(){return this.isPlaying}}const audioManager=new AudioManager;class BaseQuizModule{constructor(e={}){this.state={data:[],currentIndex:0,score:0,totalQuestions:0,currentItem:null,hasAnswered:!1,wrongAnswers:[],startTime:null,endTime:null},this.config={storagePrefix:e.storagePrefix||"quiz_",enableProgressTracking:!1!==e.enableProgressTracking,...e},this.elements={}}initialize(e){this.state.data=e,this.state.totalQuestions=e.length,this.state.currentIndex=0,this.state.score=0,this.state.wrongAnswers=[],this.state.startTime=Date.now(),this.state.endTime=null,this.loadCurrentItem()}loadCurrentItem(){return this.state.currentIndex<this.state.data.length?(this.state.currentItem=this.state.data[this.state.currentIndex],this.state.hasAnswered=!1,this.state.currentItem):null}nextItem(){return this.state.currentIndex++,this.state.currentIndex>=this.state.totalQuestions?(this.state.endTime=Date.now(),!1):null!==this.loadCurrentItem()}checkAnswer(e,t,s=!1){if(this.state.hasAnswered)return!1;const r=(s?String(e).trim():String(e).trim().toLowerCase())===(s?String(t).trim():String(t).trim().toLowerCase());return r?this.state.score++:this.state.wrongAnswers.push({index:this.state.currentIndex,item:this.state.currentItem,userAnswer:e,correctAnswer:t}),this.state.hasAnswered=!0,r}updateProgress(){const e=`${this.state.currentIndex+1} / ${this.state.totalQuestions}`,t=(this.state.currentIndex+1)/this.state.totalQuestions*100;this.elements.progressText&&(this.elements.progressText.textContent=e),this.elements.progressBar&&(this.elements.progressBar.style.width=`${t}%`)}updateScore(){const e=`${this.state.score} / ${this.state.totalQuestions}`;this.elements.scoreText&&(this.elements.scoreText.textContent=e)}getResults(){const e=this.state.score/this.state.totalQuestions*100,t=this.state.endTime?this.state.endTime-this.state.startTime:0;return{score:this.state.score,total:this.state.totalQuestions,percentage:Math.round(e),wrongAnswers:this.state.wrongAnswers,duration:t,timestamp:(new Date).toISOString()}}saveProgress(){if(!this.config.enableProgressTracking)return;const e=`${this.config.storagePrefix}progress`;storage.set(e,{currentIndex:this.state.currentIndex,score:this.state.score,wrongAnswers:this.state.wrongAnswers,timestamp:Date.now()})}loadProgress(){if(!this.config.enableProgressTracking)return null;const e=`${this.config.storagePrefix}progress`;return storage.get(e)}clearProgress(){const e=`${this.config.storagePrefix}progress`;storage.remove(e)}reset(){this.state.currentIndex=0,this.state.score=0,this.state.wrongAnswers=[],this.state.hasAnswered=!1,this.state.startTime=Date.now(),this.state.endTime=null,this.loadCurrentItem()}cacheElements(e){Object.entries(e).forEach(([e,t])=>{this.elements[e]=document.getElementById(t)||document.querySelector(t)})}}const DOMUtils={resetFormElements(e){e.forEach(e=>{const t=document.getElementById(e);t&&("INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName||(t.value="",t.disabled=!1),t.classList.remove("incorrect","correct","disabled","active"))})},toggleButtonGroup(e,t,s="value"){e.forEach(e=>{const r=e.dataset[s]===t;e.classList.toggle("active",r)})},show(e,t="block"){e&&(e.style.display=t)},hide(e){e&&(e.style.display="none")},toggle(e,t){e&&(e.style.display=void 0!==t?t?"block":"none":"none"===e.style.display?"block":"none")},createFromHTML(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild},debounce(e,t){let s;return function(...r){clearTimeout(s),s=setTimeout(()=>e.apply(this,r),t)}}};"undefined"!=typeof module&&module.exports&&(module.exports={StorageManager:StorageManager,storage:storage,AudioManager:AudioManager,audioManager:audioManager,BaseQuizModule:BaseQuizModule,DOMUtils:DOMUtils});