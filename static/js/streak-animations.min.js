class StreakAnimationController{constructor(e={}){this.options={enableAudio:!1!==e.enableAudio,grade:e.grade||4,reducedMotion:this._prefersReducedMotion(),...e},this.animationQueue=[],this.isAnimating=!1,this.elements={scoreDisplay:null,streakCard:null,multiplierBadge:null,shieldBadge:null,nearMissCard:null,pointBurstContainer:null,progressStar:null},this.audioManager=null,this._initializeDOMElements()}_prefersReducedMotion(){return"undefined"!=typeof window&&window.matchMedia("(prefers-reduced-motion: reduce)").matches}_initializeDOMElements(){"undefined"!=typeof document&&(this.elements.scoreDisplay=document.getElementById("currentScore"),this.elements.streakCard=document.getElementById("streakCard"),this.elements.multiplierBadge=document.getElementById("multiplierBadge"),this.elements.shieldBadge=document.getElementById("shieldBadge"),this.elements.nearMissCard=document.getElementById("nearMissCard"),this.elements.pointBurstContainer=document.getElementById("pointBurstContainer"),this.elements.progressStar=document.getElementById("progressStar"))}setAudioManager(e){this.audioManager=e}async playCorrectFeedback(e){if(this.options.reducedMotion)return void this._updateScoreDisplay(e.score);const t=[];t.push(()=>this._playCorrectPing()),t.push(()=>this._playPointBurst(e.totalPointsEarned,e.score)),e.streakMilestone&&t.push(()=>this._playStreakMilestone(e.streakMilestone)),e.shieldUnlocked&&t.push(()=>this._playShieldUnlock()),e.multiplierActive&&3===e.currentStreak&&t.push(()=>this._playMultiplierActivation()),await this._executeAnimationQueue(t)}async playIncorrectFeedback(e){if(this.options.reducedMotion)return void(e.nearMiss&&this._showNearMissMessage(e.nearMissMessage));const t=[];e.streakProtected&&t.push(()=>this._playShieldProtection()),e.nearMiss&&!e.streakProtected&&t.push(()=>this._playNearMiss(e.nearMissMessage)),await this._executeAnimationQueue(t)}async _executeAnimationQueue(e){this.isAnimating=!0;for(const t of e)try{await t()}catch(e){console.warn("Animation failed:",e)}this.isAnimating=!1}async _playCorrectPing(){this.options.enableAudio&&this.audioManager&&this._playSound("correct","soft");const e=document.querySelector(".answer-feedback-check");e&&(e.style.animation="gentle-bounce 300ms ease-out",await this._wait(300),e.style.animation="")}async _playPointBurst(e,t){if(!this.elements.pointBurstContainer)return void this._updateScoreDisplay(t);const s=this._createPointParticles(e);await this._animatePointBurst(s),await this._animatePointsToStar(s),this._updateScoreDisplay(t),s.forEach(e=>e.remove())}_createPointParticles(e){const t=this.elements.pointBurstContainer,s=[],i=Math.min(3*e,15);for(let e=0;e<i;e++){const e=document.createElement("div");e.className="point-particle",e.textContent="‚≠ê",e.style.cssText="\n                position: absolute;\n                font-size: 1.2rem;\n                pointer-events: none;\n                opacity: 0;\n            ",t.appendChild(e),s.push(e)}return s}async _animatePointBurst(e){const t=this.elements.pointBurstContainer.offsetWidth/2,s=this.elements.pointBurstContainer.offsetHeight/2;e.forEach((i,a)=>{const n=2*Math.PI*a/e.length,l=40+20*Math.random(),r=Math.cos(n)*l,o=Math.sin(n)*l;i.style.left=`${t}px`,i.style.top=`${s}px`,i.style.transition="all 200ms ease-out",i.style.opacity="1",i.offsetHeight,i.style.transform=`translate(${r}px, ${o}px)`}),await this._wait(200)}async _animatePointsToStar(e){if(!this.elements.progressStar)return;const t=this.elements.progressStar.getBoundingClientRect(),s=this.elements.pointBurstContainer.getBoundingClientRect(),i=t.left-s.left+t.width/2,a=t.top-s.top+t.height/2;e.forEach((e,t)=>{setTimeout(()=>{e.style.transition="all 400ms cubic-bezier(0.4, 0.0, 0.2, 1)",e.style.left=`${i}px`,e.style.top=`${a}px`,e.style.opacity="0",e.style.transform="scale(0.3)"},30*t)}),await this._wait(400),this.elements.progressStar&&(this.elements.progressStar.style.animation="star-pulse 300ms ease-out",await this._wait(300),this.elements.progressStar.style.animation="")}_updateScoreDisplay(e){if(!this.elements.scoreDisplay)return;const t=parseInt(this.elements.scoreDisplay.textContent)||0;if(e===t)return;const s=Math.min(e-t,10);let i=t;const a=setInterval(()=>{i+=Math.ceil((e-i)/2),i>=e&&(i=e,clearInterval(a)),this.elements.scoreDisplay.textContent=i},300/s)}async _playStreakMilestone(e){if(!this.elements.streakCard)return;const{emoji:t,title:s,tier:i,bonusPoints:a,multiplierApplied:n}=e;let l=`+${a} punten!`;n&&(l=`+${a} punten! (x2 bonus)`),this.elements.streakCard.innerHTML=`\n            <div class="streak-card-content streak-tier-${i}">\n                <div class="streak-emoji">${t}</div>\n                <div class="streak-title">${s}</div>\n                <div class="streak-bonus">${l}</div>\n            </div>\n        `,this.options.enableAudio&&this.audioManager&&("celebration"===i?this._playSound("celebration","loud"):"skill"===i?this._playSound("success","medium"):this._playSound("success","soft")),this.elements.streakCard.style.display="block",this.elements.streakCard.style.animation="slide-in-up 300ms ease-out",await this._wait(300),"celebration"!==i||this.options.reducedMotion||this._playConfetti(),await this._wait(2e3),this.elements.streakCard.style.animation="fade-out 300ms ease-out",await this._wait(300),this.elements.streakCard.style.display="none",this.elements.streakCard.style.animation=""}_playConfetti(){"undefined"!=typeof confetti&&confetti({particleCount:50,spread:70,origin:{y:.6},colors:["#FFD700","#FFA500","#FF69B4","#00CED1"]})}async _playShieldUnlock(){this.elements.shieldBadge&&(this.elements.shieldBadge.innerHTML='\n            <div class="shield-badge-content">\n                <div class="shield-icon">üõ°Ô∏è</div>\n                <div class="shield-label">Schild verdiend!</div>\n            </div>\n        ',this.options.enableAudio&&this.audioManager&&this._playSound("powerup","medium"),this.elements.shieldBadge.style.display="flex",this.elements.shieldBadge.style.animation="shield-appear 500ms ease-out",await this._wait(500),this.elements.shieldBadge.style.animation="")}async _playMultiplierActivation(){this.elements.multiplierBadge&&(this.elements.multiplierBadge.innerHTML='\n            <div class="multiplier-badge-content">\n                <span class="multiplier-value">x2</span>\n            </div>\n        ',this.elements.multiplierBadge.style.display="flex",this.elements.multiplierBadge.style.animation="multiplier-pulse 500ms ease-out",await this._wait(500),this.elements.multiplierBadge.style.animation="")}async _playShieldProtection(){this.elements.shieldBadge&&(this.elements.shieldBadge.innerHTML='\n            <div class="shield-badge-content shield-used">\n                <div class="shield-icon">üõ°Ô∏è</div>\n                <div class="shield-label">Bonus gered!</div>\n            </div>\n        ',this.options.enableAudio&&this.audioManager&&this._playSound("shield","medium"),this.elements.shieldBadge.style.animation="shield-protect 600ms ease-out",await this._wait(600),this.elements.shieldBadge.style.animation="fade-out 300ms ease-out",await this._wait(300),this.elements.shieldBadge.style.display="none",this.elements.shieldBadge.style.animation="")}async _playNearMiss(e){this.elements.nearMissCard&&(this.elements.nearMissCard.innerHTML=`\n            <div class="near-miss-content">\n                <div class="near-miss-emoji">üí™</div>\n                <div class="near-miss-message">${e}</div>\n            </div>\n        `,this.elements.nearMissCard.style.display="block",this.elements.nearMissCard.style.animation="slide-in-up 300ms ease-out",await this._wait(300),await this._wait(2e3),this.elements.nearMissCard.style.animation="fade-out 300ms ease-out",await this._wait(300),this.elements.nearMissCard.style.display="none",this.elements.nearMissCard.style.animation="")}_showNearMissMessage(e){this.elements.nearMissCard&&(this.elements.nearMissCard.innerHTML=`\n            <div class="near-miss-content">\n                <div class="near-miss-emoji">üí™</div>\n                <div class="near-miss-message">${e}</div>\n            </div>\n        `,this.elements.nearMissCard.style.display="block",setTimeout(()=>{this.elements.nearMissCard.style.display="none"},2e3))}_playSound(e,t="medium"){if(!this.options.enableAudio||!this.audioManager)return;const s={correct:{path:"/static/audio/correct.mp3",fallback:"Correct!"},success:{path:"/static/audio/success.mp3",fallback:"Geweldig!"},celebration:{path:"/static/audio/celebration.mp3",fallback:"Fantastisch!"},powerup:{path:"/static/audio/powerup.mp3",fallback:"Schild verdiend!"},shield:{path:"/static/audio/shield.mp3",fallback:"Beschermd!"}}[e];if(!s)return;const i={soft:.3,medium:.6,loud:.9};try{this.audioManager.playAudio(s.path,s.fallback,{volume:i[t]||.6})}catch(e){console.warn("Audio playback failed:",e)}}_wait(e){return new Promise(t=>setTimeout(t,e))}updateProgressStar(e){this.elements.progressStar&&(this.elements.progressStar.classList.remove("star-empty","star-bronze","star-silver","star-gold"),this.elements.progressStar.classList.add(`star-${e}`),"empty"===e||this.options.reducedMotion||(this.elements.progressStar.style.animation="star-fill 600ms ease-out",setTimeout(()=>{this.elements.progressStar.style.animation=""},600)))}renderStickers(e,t){const s=document.getElementById("stickerCollection");if(!s)return;if(0===e.length)return void(s.style.display="none");let i='<div class="sticker-collection-title">Wat je deze ronde hebt ontdekt:</div>';i+='<div class="sticker-grid">',e.forEach(e=>{const s=t(e);s&&(i+=`\n                <div class="sticker-card">\n                    <div class="sticker-emoji">${s.emoji}</div>\n                    <div class="sticker-title">${s.title}</div>\n                    <div class="sticker-description">${s.description}</div>\n                </div>\n            `)}),i+="</div>",i+='<div class="sticker-disclaimer">Blijft bewaard op dit apparaat.</div>',s.innerHTML=i,s.style.display="block"}reset(){this.elements.streakCard&&(this.elements.streakCard.style.display="none"),this.elements.multiplierBadge&&(this.elements.multiplierBadge.style.display="none"),this.elements.shieldBadge&&(this.elements.shieldBadge.style.display="none"),this.elements.nearMissCard&&(this.elements.nearMissCard.style.display="none"),this.animationQueue=[],this.isAnimating=!1}}"undefined"!=typeof module&&module.exports&&(module.exports={StreakAnimationController:StreakAnimationController});